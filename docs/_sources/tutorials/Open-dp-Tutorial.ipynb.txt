{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING (theano.tensor.blas): Using NumPy C-API based implementation for BLAS functions.\n"
     ]
    }
   ],
   "source": [
    "import os, sys\n",
    "\n",
    "sys.path.append(os.path.join(\"../..\"))\n",
    "\n",
    "import matplotlib.pyplot as plt\n",
    "import arviz as az\n",
    "import numpy as np\n",
    "\n",
    "import privugger as pv\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Example of using Privugger on OpenDP "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In this first example we use the differential privacy libray *open dp* on a program with information about *age, sex, education, race, income and marriage status*. The program computes the mean of the ages and add Laplacian noise to it. \n",
    "\n",
    "(explain sensativity)\n",
    "\n",
    "Below we show the program with it's imports embedded in the function body. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "def dp_program(age,sex,educ,race,income,married,N):\n",
    "    import opendp.smartnoise.core as sn\n",
    "    import pandas as pd\n",
    "\n",
    "\n",
    "    \n",
    "    ## Dataframe definition (can be automatized)\n",
    "    temp_file='temp.csv'\n",
    "    var_names = [\"age\", \"sex\", \"educ\", \"race\", \"income\", \"married\"]\n",
    "    data = {\n",
    "        \"age\":     age,\n",
    "        \"sex\":     sex,\n",
    "        \"educ\":    educ,\n",
    "        \"race\":    race,\n",
    "        \"income\":  income,\n",
    "        \"married\": married\n",
    "    }\n",
    "    df = pd.DataFrame(data,columns=var_names)\n",
    "    \n",
    "    ## After here the program works on a pandas dataframe\n",
    "    df.to_csv(temp_file)\n",
    "    with sn.Analysis() as analysis:\n",
    "        # load data\n",
    "        data = sn.Dataset(path=temp_file,column_names=var_names)\n",
    "\n",
    "        # get mean of age\n",
    "        age_mean = sn.dp_mean(data = sn.to_float(data['income']),\n",
    "                              privacy_usage = {'epsilon': .1},\n",
    "                              data_lower = 0., # min income\n",
    "                              data_upper = 200., # max income                   \n",
    "                              data_rows = N\n",
    "                             )\n",
    "    analysis.release()\n",
    "    return np.float64(age_mean.value)   "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We model an attackers knowledge about the information as probability distributions using the Privugger interface. Privug allows for both discrete and continuous distributions. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "N         = 150\n",
    "N_rv      = pv.Constant('N', N)\n",
    "age       = pv.DiscreteUniform('age', 0,150,num_elements=N)\n",
    "sex       = pv.DiscreteUniform('sex', 0,2,num_elements=N)\n",
    "educ      = pv.DiscreteUniform('educ', 0,10,num_elements=N)\n",
    "race      = pv.DiscreteUniform('race', 0,50,num_elements=N)\n",
    "income    = pv.Normal('income', mu=100,std=5,num_elements=N)\n",
    "married   = pv.DiscreteUniform('married', 0,1,num_elements=N)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Next we create the two constructs:\n",
    "    - dataset\n",
    "    - program  \n",
    "The dataset collects the attackers *prior* knowledge about the input to the program. The program is a set of a *dataset, output type and a program*. The output type specifies the output type of the program, in this case it is a floating point number as the program calulates the mean. The function is the program specified above. Lastly we use the privug interface to make inference. This is done by calling *infer* and specifying the *program, number of cores, number of chains, number of draws, and the backend which is pymc3 in this example* "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Multiprocess sampling (2 chains in 4 jobs)\n",
      "CompoundStep\n",
      ">CompoundStep\n",
      ">>Metropolis: [N]\n",
      ">>Metropolis: [married]\n",
      ">>Metropolis: [race]\n",
      ">>Metropolis: [educ]\n",
      ">>Metropolis: [sex]\n",
      ">>Metropolis: [age]\n",
      ">NUTS: [income]\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "\n",
       "    <div>\n",
       "        <style>\n",
       "            /* Turns off some styling */\n",
       "            progress {\n",
       "                /* gets rid of default border in Firefox and Opera. */\n",
       "                border: none;\n",
       "                /* Needs to be in here for Safari polyfill so background images work as expected. */\n",
       "                background-size: auto;\n",
       "            }\n",
       "            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n",
       "                background: #F44336;\n",
       "            }\n",
       "        </style>\n",
       "      <progress value='42000' class='' max='42000' style='width:300px; height:20px; vertical-align: middle;'></progress>\n",
       "      100.00% [42000/42000 02:45<00:00 Sampling 2 chains, 0 divergences]\n",
       "    </div>\n",
       "    "
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Sampling 2 chains for 1_000 tune and 20_000 draw iterations (2_000 + 40_000 draws total) took 166 seconds.\n",
      "/home/rasmuscarl/.local/lib/python3.8/site-packages/xarray/core/nputils.py:215: RuntimeWarning: All-NaN slice encountered\n",
      "  result = getattr(npmodule, name)(values, axis=axis, **kwargs)\n",
      "The rhat statistic is larger than 1.4 for some parameters. The sampler did not converge.\n",
      "The estimated number of effective samples is smaller than 200 for some parameters.\n"
     ]
    }
   ],
   "source": [
    "ds        = pv.Dataset(input_specs = [age, sex, educ, race, income, married, N_rv])\n",
    "program   = pv.Program(name=\"differential_privacy\", dataset=ds, output_type=pv.Float, function=dp_program)\n",
    "trace     = pv.infer(program, cores=4, chains=2, draws=20000, method='pymc3', return_model=False)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Lastly we can use Privugger to calculate different leakage measures. We do it by using the trace that was produced by the calling infer. In this case we calculate *mutual information*. Note that the output of the program can be accessed in the trace by refering to 'output'. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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qC4e/g7pob+ZmW1CXP2LmZlVXbt/W8zMWtc1D73Q1lmomvOP2LOts7DFcHApodoHU7k79M9+9jNmzZrFtddey+jRo5k6dSodOnRoMv3SpUt58sknOfnkk0v2l+upp57igQceYPz48RVN1xrWrl3LqFGjmDp1Kh07evc0a698W2wTUldXxz777MPEiRM5/vjjmw0sAL///e+ZNWtWk/2F1q9f3+R8DjrooE0isAB07tyZkSNHctddd7Wc2Mw2WQ4um5C5c+cyaNAgbr/9dsaM+bB2nEmTJjF8+HAGDx7MiBEjWLZsGU888QQXXHABkyZNYsiQITz++OON+hcvXsxJJ53E2WefzfDhw7niiis4+uijee211zZY7kknncQf/vAHAI4//nguueQSDjnkED71qU/x8MMPA/Daa69xwgknsO+++7L33nszbdo0nn/+eQ4//HCGDBnCqFGjePPNNxvmd+655zJixAh23XVXnnjiCU499VT23HNPxo0b17Dcl156iTFjxjB06FCGDRvGwoULATj22GO5/fbi5r7NrD1xcNmEzJs3j7333pvFixdT2CzAYYcdxtNPP82cOXM44ogjuPvuuxkxYgQHHHAAv/nNb5g9ezaHHHJIo/7ddtuNuro6PvGJT/D0009zySWXMGXKFHr27Flyufvssw+Qrp623357Hn/8cX784x9z++23s27dOo466ijOOOMMnn32WWbNmsVee+3FCSecwNVXX83s2bM54ogjuOaaaxrmsdtuu/HEE09w9tlnM27cOH7wgx+wYMEC7r//ftasWcP777/PmWeeydVXX82MGTO47LLLuPLKVFH2wIEDmT59euuvcDNrNQ4um4glS5awzTbbsG7dOrbffvtG42666SaGDRvG4MGDuf766+nSpQsACxcuZO+9925IV9i/evVqVqxYwaWXXkpzVq9ezdq1a+nWrRvvvvsuq1at4vzzzwdStTjbb7899913H/369eMLX/gCAB/72Md44IEHGDFiBEOGDAGgf//+vPHGG6xevZq33nqL8847D0jfcIwbN46dd96Zjh070qFDBzp37sx9993H/PnzOeGEExgyZAjf+c53GspVn+btt9/+SOvUzNqOn5huIuqft3Tt2rXR19q33HIL06ZNY+rUqWy77bYccsghDBgwgDfffJNu3bo1PPQu7p8/fz4HHnhgiw/F58+fT//+/QFYsGAB+++/f8Oznrlz5zJw4EBmz57N8OHDG023YMECBg0a1Cj//fv3Z/78+ey3335stVX63TJnzhy+/vWvA+mFg549eyKJOXPmMGHChEa3yQqtWbOmIdiYWfvjK5dNRP3zlh122IH169c3BJi6ujoOOuggtt12W+655x6eeuopBg0axMsvv9zoFldxf32wKjRy5EhefbVxlW6F6erq6hquROrztM8++/DJT36S+fPnNwxftmwZvXr1YsGC1BzP4sWLufXWW/nKV75CXV0dgwcP3mAekAJNfffOO+/Mgw8+yAcffNCw7FTbDyxfvpyddtrJFTmatWO+cimhLd6Fr6ur45hjjgHg85//PE888QSjRo3i9NNP5/jjj+f222/n85//PLvtthvbbLMNe++9N2+++SYDBw7khhtuYJ999mnUX1dXx7BhHzZ788EHH7Bo0SJ23HHHDZZbn66uro4DDzywYdy8efMYOHAg/fr148tf/jIDBgygU6dOjB8/nlNPPZUpU6YwaNAgunbtysSJE+nevXuj+a1evZr33nuPHXbYAWgcaL761a/yyCOP0K9fP7p27crAgQO57bbbAHjkkUca1oWZtU+q/7W4pRg6dGgUN3P83HPP0a9fvzbK0YZmzZrFNddcw6233lq1ec6bN4+JEydy9dVXV22ereX444/nyiuvZM89t5wP3ja1fbCQP6I0STMjYmgl0/i22CZov/3247DDDmv225RKDRw4sF0ElrVr13LsscduUYHFbHPk22KbqK9+9attnYU20blzZ77yla+0dTbM7CPylYuZmVWdg4uZmVWdg4uZmVWdg4uZmVWdg4uZmVWdg4uZmVWdg4uZmVWdv3Mp5ZErqju/wy4uK1lbtURZ7Mwzz+TYY49lxx13bNRC5be//W0efvhhDjnkEDp37tzQ/ZOf/OQjLa85xWVqqdXM3//+9/zyl79sqEqmJbVohdOta9qWqGZXLpJGS1ooaZGki0qM31rSXXn8M5L6FIy7OA9fKOnIguHbS5ok6XlJz0n6TI2K0yraqiXKYs8++yxDhgxp1ELliy++yJNPPsmcOXM477zzGrrLDSwbW9tAcZlaajVzzpw5jSrfbClPtWiF061r2paoJsFFUgfgOuAooD9wiqT+RcnGASsjYnfgGuCqPG1/YCwwABgNXJ/nB/Bj4IGI2BsYDDzX2mVpTW3VEuULL7zAiBEjGDRoEBMmTOD111+nd+/eDS1ULly4kEMPPZRXXnmFHXbYgeHDh/PKK6+w77778s477zTZomTx8ptK11Trl8VlrC/TH/7wh5LrBFJwKayVuVhxnurnN3PmTA499NCGdPPmzeOggw5qcv3Dhq1zPv744w3TQKojbuTIkYBb17QtT62uXIYBiyJicUSsBe4ExhSlGQPcnLsnASMlKQ+/MyLWRMRLwCJgmKRuwCHAjQARsTYi3mr9orSetmiJcs2aNRx33HFcffXV1NXV8eqrrzY0OFbfQuVee+3FaaedxuWXX87KlSs5++yzufzyy3n22Wfp3Llzky1KFi7/wgsvbDZdceuXwAZl3G233RryVGqdQMtXLsXrpH5+/fr144UXPqyg8dJLL224oim1rFKtcw4ePJjFixc3XKVdcMEF/PCHPwTcuqZteWp1A7gXsKSgfylwYFNpImKdpFVA9zz86aJpewHvAcuAX0oaDMwEvhUR7xQvXNJZwFkAn/rUp6pRnqprqSXKu+66izVr1vD666/z/e9/H6hOS5T33Xdfw5UEwIABA+jSpUujFiohnZTrr6YKuwtblARYt24dn/3sZzdYflPpmmr9sqky1efpRz/60Qbr5P3332fVqlX06NGjZFmL81Rcxq5du/LWW2+xePFiVq5cyahRo5pc/6Va56xff/Pnz+dPf/oTu+66K/vttx/QuHXN7bbbrtltYrY5aM9PFzsC+wHfiIhnJP0YuAj4t+KEEXEDcAOkKvdrmssytVVLlHV1dey///4N/fW3hwpbqKyf38CBAzfobqpFyZkzZzZaflPpZsyYUbL1y6bK1L9//ybXSWG19W+88QajR4/myCOPZOHChUyaNGmDdVJcxv79+/P8889z+eWX873vfa/Z9f/b3/52g9Y5AYYPH86TTz7J9ddfzwMPPNBonFvXtC1JrW6LvQrsUtDfOw8rmUZSR6AbsLyZaZcCSyPimTx8EinYtEtt1RJl9+7dmTdvHpACwh133MHgwYMbTf/222/TqVMnunbt2qgbmm5Rsnj5zaUr1fplc2Vqap0UPm+ZPn06p5xyCldccQUf//jHWb58+QZ5Ku4fMGAAEydOJCI4+OCDm13/pVrnhBRcLrnkEo477jh69erVMN6ta9qWplZXLtOBPST1JQWGscCXi9JMBk4D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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "\n",
    "#NOTE that we should not use this but our own binding in the future\n",
    "from sklearn.feature_selection import mutual_info_regression\n",
    "\n",
    "\n",
    "trace_length=15000\n",
    "attrs=['age','sex','race','educ','married']\n",
    "\n",
    "y=[mutual_info_regression(np.concatenate(trace.posterior[attr],axis=0)[:trace_length,0].reshape(-1,1),\n",
    "                          np.concatenate(trace.posterior['income'],axis=0)[:trace_length,0])[0] \n",
    "   for attr in ['age','sex','race','educ','married'] ]\n",
    "# additionally we show the mutual information between the income of the first individual in the dataset and the different attributes\n",
    "y1=[mutual_info_regression(np.concatenate(trace.posterior[attr],axis=0)[:trace_length,0].reshape(-1,1),\n",
    "                          np.concatenate(trace.posterior['differential_privacy'],axis=0)[:trace_length])[0]\n",
    "   for attr in ['age','sex','race','educ','married'] ]\n",
    "\n",
    "\n",
    "plt.bar(attrs,y, alpha=0.5,label=\"$I(attr;income)$\")\n",
    "plt.bar(attrs,y1,alpha=0.5,label=\"$I(attr;differential_privacy)$\")\n",
    "plt.xlabel('attr')\n",
    "plt.ylabel('$I(income;attr)$')\n",
    "plt.title(\"Mutual information between income, and other attributes\")\n",
    "plt.legend(loc=\"best\")\n",
    "plt.show()"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
