

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Getting started with privugger &mdash; Privugger  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example of using Privugger on OpenDP" href="Open-dp-Tutorial.html" />
    <link rel="prev" title="Welcome to privugger’s documentation!" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Privugger
          

          
            
            <img src="../_static/privugger-logo-tiny.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Privugger Tutorials &amp; Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started with privugger</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Program-to-analyze">Program to analyze</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Input-specification-(attacker-knowledge-about-the-input)">Input specification (attacker knowledge about the input)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Program-specification">Program specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Observation-specification">Observation specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Inference">Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Posterior-Analysis">Posterior Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Distribution-visualization">Distribution visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Prior-vs-Posterior">Prior vs Posterior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Probability-queries-and-standard-statistics">Probability queries and standard statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Quantitative-Information-Flow-(QIF)-metrics">Quantitative Information Flow (QIF) metrics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Mutual-Information">Mutual Information</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Open-dp-Tutorial.html">Example of using Privugger on OpenDP</a></li>
<li class="toctree-l1"><a class="reference internal" href="Governor.html">Governor case study</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API and Developer Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../privugger.transformer.html">Privugger Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privugger.datastructures.html">Privugger Datastructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privugger.distributions.html">Privugger Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privugger.inference.html">Privugger Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privugger.measures.html">Privugger Measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../privugger.attacker.html">Attacker Generation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Privugger</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting started with privugger</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/Tutorial.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># disable FutureWarnings to have a cleaner output</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># move to previouse directory to access the privugger code</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;../../&quot;</span><span class="p">))</span>

<span class="c1"># external libraries used in the notebook</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># privugger library</span>
<span class="kn">import</span> <span class="nn">privugger</span> <span class="k">as</span> <span class="nn">pv</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING (theano.tensor.blas): Using NumPy C-API based implementation for BLAS functions.
</pre></div></div>
</div>
<div class="section" id="Getting-started-with-privugger">
<h1>Getting started with privugger<a class="headerlink" href="#Getting-started-with-privugger" title="Permalink to this headline">¶</a></h1>
<p>This tutorial shows a simple example on using privugger to analyze a program that computes the average of a set of ages. Privugger is based on the privug method introduced in <a class="reference external" href="https://arxiv.org/abs/2011.08742">this paper</a>－you may want to have a look at the paper if some of the concepts explained below are new to you.</p>
<div class="section" id="Program-to-analyze">
<h2>Program to analyze<a class="headerlink" href="#Program-to-analyze" title="Permalink to this headline">¶</a></h2>
<p>Privugger is a tool to quantify privacy risks in python <em>programs</em>. Consequently, the very first step is to define the program we want to analyze.</p>
<p>In this example, we consider a program computing the average of a list of ages. The program takes as input a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array whose elements are of type <code class="docutils literal notranslate"><span class="pre">Float</span></code> (each element correspond to an age).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="n">ages</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ages</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">ages</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>At first sight, one might think that releasing publicly the output of the program should no pose any privacy. Let’s verify whether this is the case with Privugger.</p>
</div>
<div class="section" id="Input-specification-(attacker-knowledge-about-the-input)">
<h2>Input specification (attacker knowledge about the input)<a class="headerlink" href="#Input-specification-(attacker-knowledge-about-the-input)" title="Permalink to this headline">¶</a></h2>
<p>The next step in using privugger is to specify the knowledge of our (assumed) attacker about the input of the program. In other words, what are our assumptions on what the attacker knows about the ages used in this program?</p>
<p>In this example, we assume that the dataset contains the ages of 100 individuals, and that the attacker believes that the most likely age for the individuals is 35, but she is not certain about it.</p>
<p>The above attacker knowledge can be modeled with a <a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">Normal distribution</a> with mean 35 and some standard deviation to amount for the uncertainty (in this case we choose a standard deviation of 2).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># input spec</span>
<span class="n">ages</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;ages&#39;</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span><span class="n">std</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">num_elements</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After we define the specification of the input, we wrap everything into a <em>dataset</em>. Datasets are objects modeling the input of the programs we want to analyze. In this case, our program of interest takes an array of ages. Consequently, the dataset constructor takes as only input the specification of this array (defined in the cell above).</p>
<p>If the program under analysis had more parameters, the <code class="docutils literal notranslate"><span class="pre">input_specs</span></code> parameter below should have as many elements as parameters in the program. The elements in <code class="docutils literal notranslate"><span class="pre">input_specs</span></code> do not necessarily need to be arrays, they can only be scalars. For instance, if ages if defined as <code class="docutils literal notranslate"><span class="pre">num_elements=1</span></code> then it models a single age.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a privugger dataset</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">input_specs</span><span class="o">=</span><span class="p">[</span><span class="n">ages</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Program-specification">
<h2>Program specification<a class="headerlink" href="#Program-specification" title="Permalink to this headline">¶</a></h2>
<p>The next step is program specification. That is, we put together the program’s code and the specification of the input. Additionally, we need to indicate the type of the output of the program.</p>
<p>In the cell below, we create a <code class="docutils literal notranslate"><span class="pre">Program</span></code> object that encapsulates the program specification. The first parameter specifies the name of the distribution of the output of this program. The parameter <code class="docutils literal notranslate"><span class="pre">dataset</span></code> takes a privugger <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> matching the signature of the program to analyze. This program is specified in <code class="docutils literal notranslate"><span class="pre">function</span></code> which may be a python method or a file containing the method to analyze. Finally, in <code class="docutils literal notranslate"><span class="pre">output_type</span></code> we specify the type of the output of the program.</p>
<p>The program output distribution is automatically named <code class="docutils literal notranslate"><span class="pre">'output'</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">program</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Program</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span>
                     <span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span>
                     <span class="n">output_type</span><span class="o">=</span><span class="n">pv</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span>
                     <span class="n">function</span><span class="o">=</span><span class="n">avg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Observation-specification">
<h2>Observation specification<a class="headerlink" href="#Observation-specification" title="Permalink to this headline">¶</a></h2>
<p>In this step, we may add an <em>observation</em> to any of the program variables. Observations are predicates modeling binary inequalities. They have the form <span class="math notranslate nohighlight">\(a \, R \, b\)</span> with <span class="math notranslate nohighlight">\(a, b \in \mathbb{N}\)</span> or <span class="math notranslate nohighlight">\(a,b \in \mathbb{R}\)</span> and <span class="math notranslate nohighlight">\(R \in \{&lt;,&gt;,=&lt;,&gt;=,==\}\)</span>. Additionally, observation have a <code class="docutils literal notranslate"><span class="pre">precision</span></code> parameter that allow us to model the strength of the observation. This is important as, e.g., in continuous domains the probability of any single outcome is 0. A precision of 0
requires the observation to hold with probability 1, the larger the precision the lower the probability require for the observation to hold.</p>
<p>Here we add an observation saying that the output equals 44 and with a precision of 0.1.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">program</span><span class="o">.</span><span class="n">add_observation</span><span class="p">(</span><span class="s1">&#39;output==44&#39;</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Inference">
<h2>Inference<a class="headerlink" href="#Inference" title="Permalink to this headline">¶</a></h2>
<p>In this step, we infer the distributions of all the variables we defined above. We may choose different backends for this purpose. Currently we support <a class="reference external" href="https://docs.pymc.io/en/stable/">PyMC3</a> (used in this example) and <a class="reference external" href="https://www.scipy.org/">scipy</a>.</p>
<p>The output of the <code class="docutils literal notranslate"><span class="pre">infer</span></code> method is a <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> compatible with many statistics libraries for plotting or computing statistics (see section below)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trace</span>   <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">program</span><span class="p">,</span>
                   <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                   <span class="n">draws</span><span class="o">=</span><span class="mi">10_000</span><span class="p">,</span>
                   <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pymc3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Initializing NUTS failed. Falling back to elementwise auto-assignment.
Multiprocess sampling (2 chains in 4 jobs)
Slice: [ages]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 |██████████████████████████████| 100.00% [22000/22000 04:28&lt;00:00 Sampling 2 chains, 0 divergences]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 2 chains for 1_000 tune and 10_000 draw iterations (2_000 + 20_000 draws total) took 268 seconds.
The number of effective samples is smaller than 10% for some parameters.
</pre></div></div>
</div>
</div>
<div class="section" id="Posterior-Analysis">
<h2>Posterior Analysis<a class="headerlink" href="#Posterior-Analysis" title="Permalink to this headline">¶</a></h2>
<p>Here we show some analysis we can perform with the trace generated using privugger.</p>
<div class="section" id="Distribution-visualization">
<h3>Distribution visualization<a class="headerlink" href="#Distribution-visualization" title="Permalink to this headline">¶</a></h3>
<p>As a first example of analysis, we use the <code class="docutils literal notranslate"><span class="pre">arviz</span></code> library to visualize the distribution of the output of the <code class="docutils literal notranslate"><span class="pre">avg</span></code> program.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">],</span> <span class="n">hdi_prob</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">point_estimate</span><span class="o">=</span><span class="s1">&#39;mode&#39;</span><span class="p">);</span> <span class="c1"># plot the inferred distribution of the output</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Tutorial_22_0.png" src="../_images/tutorials_Tutorial_22_0.png" />
</div>
</div>
<p>This plot indicates that values of the output of the <code class="docutils literal notranslate"><span class="pre">avg</span></code> between 42.0 and 42.5 are the most likely with anything else having probability &lt; 0.05. This is due to the effect of the observation we set up earlier.</p>
<p>We can also visualize the distribution of each of the elements in the dataset (recall the dataset consisted in a list of 10 elements modeling the age of different individuals)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span> <span class="n">hdi_prob</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">point_estimate</span><span class="o">=</span><span class="s1">&#39;mode&#39;</span><span class="p">);</span> <span class="c1"># plot the inferred distribution of the output</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/pardo/.local/lib/python3.8/site-packages/arviz/plots/plot_utils.py:271: UserWarning: rcParams[&#39;plot.max_subplots&#39;] (40) is smaller than the number of variables to plot (100) in plot_posterior, generating only 40 plots
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Tutorial_25_1.png" src="../_images/tutorials_Tutorial_25_1.png" />
</div>
</div>
<p>We can visualize the distribution of a concrete individual to inspect the knowledge of the attacker after observation.</p>
<p>The plot below show that the attacker believes that the most likely age for individual 0 is 42 and considers plausible ages from 38 to 46. The orange line marks the probability of of the age being greater or less than 35. Remember that this was the age that the attacker considered most likely in the prior. Here can observe that, in the posterior, the attacker completely discards 35 as a possible age for individual 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span>
                  <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">],</span>
                  <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ages_dim_0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
                  <span class="n">point_estimate</span><span class="o">=</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span>
                  <span class="n">hdi_prob</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span>
                  <span class="n">ref_val</span><span class="o">=</span><span class="mi">35</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Tutorial_27_0.png" src="../_images/tutorials_Tutorial_27_0.png" />
</div>
</div>
<div class="section" id="Prior-vs-Posterior">
<h4>Prior vs Posterior<a class="headerlink" href="#Prior-vs-Posterior" title="Permalink to this headline">¶</a></h4>
<p>We can also visualize the change in knowledge by plotting the prior and posterior distributions of one of the individuals. We do this by extracting the samples of the individual, and, e.g., generating some samples using <code class="docutils literal notranslate"><span class="pre">scipy</span></code> from the prior distribution we chose.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="n">return_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">posterior_alice_age</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;ages&#39;</span><span class="p">][:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">prior_alice_age</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">posterior_alice_age</span><span class="o">.</span><span class="n">size</span><span class="p">)[</span><span class="s1">&#39;ages&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">az</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span><span class="n">prior_alice_age</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior vs Posterior attacker knowledge&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age of Alice&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Tutorial_30_0.png" src="../_images/tutorials_Tutorial_30_0.png" />
</div>
</div>
<p>These plots show a shift towards ages &gt; 35 from prior to posterior.</p>
<p>In comparing distributions, the difference gives us information about how distant they are. If the difference is 0 with low variance, it means that the prior attacker knowledge did not change after observation. Otherwise, the larger the distance the less accurate the prior attacker knowledge was. A large standard deviation in the difference distribution indicates uncertainty in the conclusion.</p>
<p>There exist other (possibly better) metrics to measure distance between distribution that are supported in privugger, see sections below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="o">-</span><span class="n">prior_alice_age</span><span class="p">,</span>
                  <span class="n">point_estimate</span><span class="o">=</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span>
                  <span class="n">hdi_prob</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span>
                  <span class="n">ref_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posterior minus prior&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Tutorial_33_0.png" src="../_images/tutorials_Tutorial_33_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Probability-queries-and-standard-statistics">
<h3>Probability queries and standard statistics<a class="headerlink" href="#Probability-queries-and-standard-statistics" title="Permalink to this headline">¶</a></h3>
<p>We can also query the traces to obtain to query the distributions and compute standard statistics.</p>
<p>Note that some of this statistics were already printed in the visualizations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability queries&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(age_0&lt;35) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prior_alice_age</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(age_0&lt;35|o≈55) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(age_0&lt;35 \/ age_0&gt;42|o≈42) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">posterior_alice_age</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">posterior_alice_age</span><span class="o">&gt;</span><span class="mi">42</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(age_0&gt;35 /\ age_0&lt;42|o≈42) = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">posterior_alice_age</span><span class="o">&gt;</span><span class="mi">35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">posterior_alice_age</span><span class="o">&lt;</span><span class="mi">42</span><span class="p">))))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Standard statistics&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E[age_0] = &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SD[age_0] = &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Var[age_0] = &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;95%_HDI[age_0] = &#39;</span><span class="p">,</span><span class="n">az</span><span class="o">.</span><span class="n">hdi</span><span class="p">(</span><span class="n">posterior_alice_age</span><span class="p">,</span><span class="n">hdi_prob</span><span class="o">=.</span><span class="mi">95</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Probability queries
P(age_0&lt;35) = 0.49965
P(age_0&lt;35|o≈55) = 0.0037
P(age_0&lt;35 \/ age_0&gt;42|o≈42) = 0.7412
P(age_0&gt;35 /\ age_0&lt;42|o≈42) = 0.2588


Standard statistics
E[age_0] =  43.499287304187945
SD[age_0] =  2.633624664500627
Var[age_0] =  6.935978873466041
95%_HDI[age_0] =  [37.9214349  48.69796968]
</pre></div></div>
</div>
</div>
<div class="section" id="Quantitative-Information-Flow-(QIF)-metrics">
<h3>Quantitative Information Flow (QIF) metrics<a class="headerlink" href="#Quantitative-Information-Flow-(QIF)-metrics" title="Permalink to this headline">¶</a></h3>
<p>Traces can also be used to compute standard information theoretic and quantitative information flow metrics.</p>
<div class="section" id="Mutual-Information">
<h4>Mutual Information<a class="headerlink" href="#Mutual-Information" title="Permalink to this headline">¶</a></h4>
<p>The privugger library comes with an interface to call the mutual information estimator from SKlearn.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">output</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(age_0;output) = &quot;</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">mi_sklearn</span><span class="p">([</span><span class="n">posterior_alice_age</span><span class="p">,</span><span class="n">output</span><span class="p">],</span><span class="n">input_inferencedata</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
I(age_0;output) =  [0.05905343]
</pre></div></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Open-dp-Tutorial.html" class="btn btn-neutral float-right" title="Example of using Privugger on OpenDP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to privugger’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Raul Pardo, Rasmus Rønneberg, Willard Rafnsson, Andrzej Wasowski &amp; Mathias Jørgensen.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>